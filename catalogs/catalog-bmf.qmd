---
title: "NCCS BMF Data Catalog"
# Format and execute settings inherited from _quarto.yml
---

```{r}
#| echo: false

library( dplyr )
library( knitr )
library( kableExtra )
library( stringr )
library( pander )

aws_df <- read.csv(
  "AWS-NCCSDATA.csv"
)
source("build-catalog-functions.R")
nccs_legacy_base_url <- "https://urbaninstitute.github.io/nccs-legacy/dictionary/core/core_archive_html/"
aws_base_url <- "https://nccsdata.s3.amazonaws.com/"

state_mapping <- c(
  "AK" = "Alaska",
  "AL" = "Alabama",
  "AR" = "Arkansas",
  "AS" = "American Samoa",
  "AZ" = "Arizona",
  "CA" = "California",
  "CO" = "Colorado",
  "CT" = "Connecticut",
  "DC" = "District of Columbia",
  "DE" = "Delaware",
  "FL" = "Florida",
  "GA" = "Georgia",
  "GU" = "Guam",
  "HI" = "Hawaii",
  "IA" = "Iowa",
  "ID" = "Idaho",
  "IL" = "Illinois",
  "IN" = "Indiana",
  "KS" = "Kansas",
  "KY" = "Kentucky",
  "LA" = "Louisiana",
  "MA" = "Massachusetts",
  "MD" = "Maryland",
  "ME" = "Maine",
  "MI" = "Michigan",
  "MN" = "Minnesota",
  "MO" = "Missouri",
  "MP" = "Northern Mariana Islands",
  "MS" = "Mississippi",
  "MT" = "Montana",
  "NC" = "North Carolina",
  "ND" = "North Dakota",
  "NE" = "Nebraska",
  "NH" = "New Hampshire",
  "NJ" = "New Jersey",
  "NM" = "New Mexico",
  "NV" = "Nevada",
  "NY" = "New York",
  "OH" = "Ohio",
  "OK" = "Oklahoma",
  "OR" = "Oregon",
  "PA" = "Pennsylvania",
  "PR" = "Puerto Rico",
  "RI" = "Rhode Island",
  "SC" = "South Carolina",
  "SD" = "South Dakota",
  "TN" = "Tennessee",
  "TX" = "Texas",
  "UT" = "Utah",
  "Un" = "Unmapped",
  "VA" = "Virginia",
  "VI" = "U.S. Virgin Islands",
  "VT" = "Vermont",
  "WA" = "Washington",
  "WI" = "Wisconsin",
  "WV" = "West Virginia",
  "WY" = "Wyoming"
)
```

<br>

<hr>

<br>

**Overview**

Files are organized by **state/territory**. Unmapped records are saved in the "Unmapped" File. A link to the data dictionary is available here:

<a href="https://nccsdata.s3.amazonaws.com/harmonized/harmonized_data_dictionary.xlsx" class="button3">Download Data Dictionary</a>

<br>

<hr>

<br>

#### Unified BMF by State/Territory

```{r}
paths <- aws_df$Key[grepl("harmonized/bmf/unified", aws_df$Key)]
paths <- paths[grepl("_BMF_", paths)]

state_abbrs <- substr(paths, 24, 25)

download_urls <- paste0(aws_base_url, paths)


download_buttons <- make_buttons(urls = download_urls, button_name = "download")
size <- aws_df %>%
  dplyr::filter(Key %in% paths) %>%
  dplyr::mutate(size_mb = paste0(as.character(round(Size / 1000000, 1)), " mb")) %>%
  dplyr::pull("size_mb")

state <- unlist(state_mapping)
catalog <- data.frame(download_buttons, size, state)

rownames(catalog) <- NULL
catalog %>%
  knitr::kable(
    escape = FALSE,
    col.names = c("Download Link", "Size", "State/Territory"),
    format = "html"
  ) %>%
  kableExtra::kable_styling()
```

## Legacy BMF

The files below contain links to the archived BMF files maintained by the now defunct [legacy NCCS website](https://urbaninstitute.github.io/nccs-legacy/). There are several legacy data dictionaries that are incomplete. NCCS has since shifted to compiling a Unified BMF that aggregates the various BMF fields instead.

```{r}

bmf_legacy_catalog <- construct_catalog(s3_catalog = aws_df,
                             series = "bmf",
                             paths = aws_df$Key)
bmf_legacy_catalog |>
  knitr::kable(escape=FALSE,
               col.names = c(
                 "Download Link",
                 "Data Dictionary",
                 "Size",
                 "Month",
                 "Year"
               ),
               format = "html") |>
   kableExtra::kable_styling()
```

<br>

<hr>

<br>

<!-- Styles loaded from shared catalog.css via _quarto.yml -->
